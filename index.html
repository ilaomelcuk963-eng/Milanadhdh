<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Millie's Reborn Nursery</title>
    <link rel="shortcut icon" href="https://placehold.co/32x32/FFB6C1/5A2D4E?text=M" type="image/x-icon">
    <style>
        :root { --main-bg: #ffe6f2; --text-color: #5a2d4e; --primary: #ff66a3; --primary-dark: #cc0066; --accent: #ff99cc; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background-color: var(--main-bg); color: var(--text-color); overflow-x: hidden; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .nav-toggle { position: fixed; top: 20px; right: 20px; z-index: 1000; cursor: pointer; background-color: var(--primary); border-radius: 50%; width: 50px; height: 50px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .nav-toggle span { display: block; width: 20px; height: 2px; background-color: white; margin: 2px 0; }
        .navigation { position: fixed; top: 0; right: -300px; width: 300px; height: 100%; background-color: rgba(255, 153, 204, 0.95); z-index: 999; transition: right 0.5s ease; padding: 80px 20px 20px; }
        .navigation.active { right: 0; }
        .navigation ul { list-style: none; }
        .navigation a { color: var(--text-color); text-decoration: none; font-size: 18px; display: block; padding: 10px 15px; border-radius: 5px; transition: all 0.3s ease; }
        .navigation a:hover { background-color: var(--accent); color: white; transform: translateX(5px); }
        .content { max-width: 1200px; margin: 0 auto; padding: 20px; }
        section { display: none; padding: 40px 20px; animation: fadeIn 0.8s ease; }
        section.active { display: block; }
        h1, h2, h3 { color: var(--primary-dark); margin-bottom: 20px; text-align: center; animation: slideIn 0.8s ease; }
        p { line-height: 1.6; margin-bottom: 15px; text-align: center; }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .photo-frame { background-color: white; border-radius: 10px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .photo-frame:hover { transform: translateY(-5px); }
        .photo-frame img { width: 100%; height: 200px; object-fit: cover; border-radius: 5px; }
        form { max-width: 600px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: var(--primary-dark); font-weight: bold; }
        input, textarea, select { width: 100%; padding: 10px 15px; border: 1px solid var(--accent); border-radius: 5px; font-size: 16px; }
        button { background-color: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: all 0.3s ease; display: block; margin: 0 auto; }
        button:hover { background-color: var(--primary-dark); transform: scale(1.05); }
        .admin-panel { background-color: white; border-radius: 10px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-top: 20px; }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .admin-table th, .admin-table td { border: 1px solid var(--accent); padding: 10px; text-align: left; word-break: break-word; }
        .admin-table th { background-color: var(--accent); color: white; }
        #comments-section { background: linear-gradient(135deg, #fff5f9 0%, #ffe6f2 100%); border-radius: 15px; }
        .notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 15px 25px; border-radius: 10px; color: white; font-weight: bold; z-index: 10000; animation: slideIn 0.5s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .notification.success { background: #4CAF50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196F3; }
        footer { background-color: var(--accent); color: white; padding: 20px; text-align: center; margin-top: 50px; }
        .social-links a { color: white; margin: 0 10px; font-size: 18px; }
    </style>
</head>
<body>
    <div class="nav-toggle" id="navToggle"><span></span><span></span><span></span></div>
    <nav class="navigation" id="navigation">
        <ul>
            <li><a href="#" data-section="home">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="#" data-section="about">–û –Ω–∞—Å</a></li>
            <li><a href="#" data-section="gallery">–ì–∞–ª–µ—Ä–µ—è</a></li>
            <li><a href="#" data-section="comments-section">–û—Ç–∑—ã–≤—ã</a></li>
            <li><a href="#" data-section="admin">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></li>
        </ul>
    </nav>

    <div class="content">
        <section id="home" class="active">
            <h1>Millie's Reborn Nursery</h1>
            <p>–°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫—É–∫–ª—ã —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–Ω—É—Ç –ª—é–±–∏–º—ã–º–∏ –∏–≥—Ä—É—à–∫–∞–º–∏ –≤–∞—à–∏—Ö –¥–µ—Ç–µ–π.</p>
        </section>

        <section id="about">
            <h2>–û –Ω–∞—Å</h2>
            <p>–ú—ã - –∫–æ–º–∞–Ω–¥–∞ –º–∞—Å—Ç–µ—Ä–æ–≤, —Å–æ–∑–¥–∞—é—â–∏—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫—É–∫–ª—ã –Ω–∞ –∑–∞–∫–∞–∑.</p>
        </section>

        <section id="gallery">
            <h2>–ì–∞–ª–µ—Ä–µ—è –∫—É–∫–æ–ª</h2>
            <div class="gallery">
                <div class="photo-frame"><img src="https://placehold.co/400x300/FFB6C1/5A2D4E?text=–ö—É–∫–ª–∞+1" alt="–§–æ—Ç–æ 1"></div>
                <div class="photo-frame"><img src="https://placehold.co/400x300/FFB6C1/5A2D4E?text=–ö—É–∫–ª–∞+2" alt="–§–æ—Ç–æ 2"></div>
                <div class="photo-frame"><img src="https://placehold.co/400x300/FFB6C1/5A2D4E?text=–ö—É–∫–ª–∞+3" alt="–§–æ—Ç–æ 3"></div>
            </div>
        </section>

        <section id="comments-section">
            <h2>üí¨ –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
            <div style="max-width: 800px; margin: 0 auto 50px; background: white; padding: 30px; border-radius: 15px;">
                <h3>–û—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤</h3>
                <form id="commentsForm">
                    <div class="form-group"><label for="commentName">–í–∞—à–µ –∏–º—è:</label><input type="text" id="commentName" required></div>
                    <div class="form-group"><label for="commentText">–í–∞—à –æ—Ç–∑—ã–≤:</label><textarea id="commentText" rows="4" required></textarea></div>
                    <div class="form-group"><label for="commentRating">–û—Ü–µ–Ω–∫–∞:</label>
                        <select id="commentRating" required>
                            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ –û—Ç–ª–∏—á–Ω–æ</option><option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ –•–æ—Ä–æ—à–æ</option><option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ –ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                        </select>
                    </div>
                    <button type="submit">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤</button>
                </form>
            </div>
            <div id="commentsList" style="display: grid; gap: 20px;"></div>
        </section>

        <section id="admin">
            <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <div id="adminLogin">
                <div class="form-group"><label>–ü–∞—Ä–æ–ª—å:</label><input type="password" id="adminPassword" required></div>
                <button id="loginBtn">–í–æ–π—Ç–∏</button>
            </div>
            
            <div id="adminPanel" class="admin-panel" style="display: none;">
                <button id="logoutBtn" style="background: #f44336; float: right;">–í—ã–π—Ç–∏</button>
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏</h3>
                <div id="commentsAdminList" style="overflow-x: auto;"></div>

                <h3 style="margin-top: 30px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h3>
                <form id="messageForm">
                    <div class="form-group"><label for="recipientId">ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö):</label><input type="text" id="recipientId" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, user-a1b2c3d4"></div>
                    <div class="form-group"><label for="messageText">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:</label><textarea id="messageText" rows="3" required></textarea></div>
                    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </form>
            </div>
        </section>
    </div>

    <footer>
        <p>–¢–µ–ª–µ—Ñ–æ–Ω: +380977057272 | –£–∫—Ä–∞–∏–Ω–∞</p>
        <div class="social-links"><a href="#">Instagram</a> <a href="#">TikTok</a> <a href="#">Telegram</a></div>
        <div id="userIdFooter" style="margin-top: 10px; font-size: 12px; color: #fce4ec;"></div>
    </footer>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:5000/api'; // –ê–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        let isAdminLoggedIn = false;
        let currentUserId = '';

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation();
            setupUserId();
            loadData();
            
            document.getElementById('commentsForm').addEventListener('submit', handleAddComment);
            document.getElementById('loginBtn').addEventListener('click', handleAdminLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleAdminLogout);
            document.getElementById('messageForm').addEventListener('submit', handleSendMessage);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
            setInterval(checkForMessages, 15000);
        });

        // --- –ù–∞–≤–∏–≥–∞—Ü–∏—è ---
        function setupNavigation() {
            const navToggle = document.getElementById('navToggle');
            const navigation = document.getElementById('navigation');
            navToggle.addEventListener('click', () => navigation.classList.toggle('active'));
            document.querySelectorAll('.navigation a').forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const sectionId = link.getAttribute('data-section');
                    document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
                    document.getElementById(sectionId)?.classList.add('active');
                    navigation.classList.remove('active');
                    if (sectionId === 'admin') checkAdminAuth();
                });
            });
        }
        
        // --- ID –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
        function setupUserId() {
            let userId = localStorage.getItem('dollShopUserId');
            if (!userId) {
                userId = `user-${Math.random().toString(36).substr(2, 8)}`;
                localStorage.setItem('dollShopUserId', userId);
            }
            currentUserId = userId;
            document.getElementById('userIdFooter').textContent = `–í–∞—à ID: ${currentUserId}`;
        }

        // --- –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (API) ---
        async function loadData() {
            try {
                const response = await fetch(`${API_BASE_URL}/data`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö');
                const data = await response.json();
                renderComments(data.comments || []);
                if(isAdminLoggedIn) renderAdminComments(data.comments || []);
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', 'error');
            }
        }

        async function handleAddComment(e) {
            e.preventDefault();
            const newComment = {
                name: document.getElementById('commentName').value,
                text: document.getElementById('commentText').value,
                rating: parseInt(document.getElementById('commentRating').value),
            };

            try {
                const response = await fetch(`${API_BASE_URL}/comments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newComment)
                });
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                showNotification('‚úÖ –û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                e.target.reset();
                loadData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            } catch (error) {
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤', 'error');
            }
        }
        
        async function deleteComment(commentId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')) return;
            try {
                const response = await fetch(`${API_BASE_URL}/comments/${commentId}`, {
                    method: 'DELETE',
                    headers: { 'Admin-Password': '1488' } // –ü–∞—Ä–æ–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                });
                 if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
                showNotification('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–¥–∞–ª–µ–Ω', 'success');
                loadData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            } catch(error) {
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }

        // --- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ---
        function handleAdminLogin() {
            if (document.getElementById('adminPassword').value === '1488') {
                isAdminLoggedIn = true;
                sessionStorage.setItem('isAdminLoggedIn', 'true');
                checkAdminAuth();
            } else {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
            }
        }

        function handleAdminLogout() {
             isAdminLoggedIn = false;
             sessionStorage.removeItem('isAdminLoggedIn');
             checkAdminAuth();
        }

        function checkAdminAuth() {
            isAdminLoggedIn = sessionStorage.getItem('isAdminLoggedIn') === 'true';
            document.getElementById('adminLogin').style.display = isAdminLoggedIn ? 'none' : 'block';
            document.getElementById('adminPanel').style.display = isAdminLoggedIn ? 'block' : 'none';
            if(isAdminLoggedIn) loadData();
        }
        
        async function handleSendMessage(e) {
            e.preventDefault();
            const recipient = document.getElementById('recipientId').value || 'global';
            const text = document.getElementById('messageText').value;

            try {
                const response = await fetch(`${API_BASE_URL}/send-message`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Admin-Password': '1488' },
                    body: JSON.stringify({ recipient, text })
                });
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
                showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!', 'success');
                e.target.reset();
            } catch(error) {
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
            }
        }

        // --- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ ---
        function renderComments(comments) {
            const list = document.getElementById('commentsList');
            if (!comments || comments.length === 0) {
                list.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>';
                return;
            }
            list.innerHTML = comments.map(c => `
                <div style="background:white; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                    <div style="display:flex; justify-content:space-between; color:#cc0066; font-weight:bold;">
                        <span>${c.name}</span><span style="color:#ffcc00;">${'‚òÖ'.repeat(c.rating)}</span>
                    </div>
                    <p style="text-align:left; margin-top:10px;">${c.text}</p>
                    <small style="color:#999;">${new Date(c.date).toLocaleDateString()}</small>
                </div>
            `).join('');
        }
        
        function renderAdminComments(comments) {
            const container = document.getElementById('commentsAdminList');
            if (!comments || comments.length === 0) {
                container.innerHTML = '<p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç.</p>'; return;
            }
            const tableRows = comments.map(c => `
                <tr>
                    <td>${c.name}</td>
                    <td>${c.text.substring(0, 50)}...</td>
                    <td>${'‚òÖ'.repeat(c.rating)}</td>
                    <td>${new Date(c.date).toLocaleDateString()}</td>
                    <td><button onclick="deleteComment('${c.id}')" style="background:#f44336; padding: 5px 10px;">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
            `).join('');
            container.innerHTML = `
                <table class="admin-table">
                    <thead><tr><th>–ò–º—è</th><th>–¢–µ–∫—Å—Ç</th><th>–†–µ–π—Ç–∏–Ω–≥</th><th>–î–∞—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr></thead>
                    <tbody>${tableRows}</tbody>
                </table>`;
        }
        
        async function checkForMessages() {
            try {
                const response = await fetch(`${API_BASE_URL}/messages/${currentUserId}`);
                const messages = await response.json();
                messages.forEach(msg => {
                    showNotification(msg.text, 'info');
                });
            } catch (error) {
                // –û—à–∏–±–∫—É –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                console.log("–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ —É–¥–∞–ª–∞—Å—å, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–æ–≤—ã—Ö.");
            }
        }

        function showNotification(msg, type) {
            const n = document.createElement('div');
            n.className = `notification ${type}`;
            n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 5000);
        }
    </script>
</body>
</html>
